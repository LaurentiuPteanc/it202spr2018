<!DOCTYPE html>
<html>
    <head>
        <title>Pteanc P5</title>
        
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    </head>
    <body>
        <video id="camera" width="200" height="200" controls autoplay></video>
        <button id="picBtn">Take Picture</button>
        <canvas id="image" width="200" height="200"></canvas>
        <canvas id="template" width="100" height="100"></canvas>
    
        
    <script>
      const camera = document.getElementById('camera');//$('#camera');
      const frameCanvas = document.getElementById('image');
      const frameContext = frameCanvas.getContext('2d');
      const picBtn = document.getElementById('picBtn')
      const key = 'AIzaSyAhKjUtfMz2x_JzgOQe5sPu1uBno2ygk1U';
      const constraints = {
        video: true,
      };
    
      navigator.mediaDevices.getUserMedia(constraints)
        .then((stream) => {
          camera.srcObject = stream;
        });
        
      console.log('adding event')
      picBtn.addEventListener("click",function(){
          //console.log('here')
          //console.log(camera.height);
        frameContext.drawImage(camera, 0, 0,camera.width,camera.height);//, frameCanvas.width, frameCanvas.height);
        var type = 'FACE_DETECTION';
        var visionAPIEndpoint = 'https://vision.googleapis.com/v1/images:annotate'
        var requestBody = {
                "requests":[
                  {
                    "image":{
                      "content":frameCanvas.toDataURL().split(",")[1]
                    },
                    "features":[
                      {
                        "type": type,
                        "maxResults":10
                      }
                    ]
                  }
                ]
        }
        $.ajax({
            method:"POST",
            contentType:"application/json",
            url:visionAPIEndpoint+"?key="+key,
            data:JSON.stringify(requestBody)})
            .done(function(data){
                console.log(data)
                var corners = data.responses[0].faceAnnotations[0].boundingPoly.vertices;
                console.log(corners)
                
                var clone = $('#template').clone();
                clone.appendTo(clone.parent());
                
                var cloneContext = clone[0].getContext('2d');
                console.log(cloneContext)
                document.getElementById('template').getContext('2d').putImageData(frameContext.getImageData(0,0,frameCanvas.width,frameCanvas.height),0,0)//, 0, 0,camera.width,camera.height);
                
            })
      })
    </script>
    </body>
    
</html>